<!DOCTYPE html>
<!--青岛研锦网络科技有限公司版权所有-->
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <title>后台管理</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}" />
    <script type="text/javascript" src="{{ url_for('static', filename='js/echarts.min.js') }}"></script>
    <script type="text/javascript">

        function getCurDate() {
            var d = new Date();
            var week;
            switch (d.getDay()) {
                case 1:
                    week = "星期一";
                    break;
                case 2:
                    week = "星期二";
                    break;
                case 3:
                    week = "星期三";
                    break;
                case 4:
                    week = "星期四";
                    break;
                case 5:
                    week = "星期五";
                    break;
                case 6:
                    week = "星期六";
                    break;
                default:
                    week = "星期天";
            }
            var years = d.getFullYear();
            var month = add_zero(d.getMonth() + 1);
            var days = add_zero(d.getDate());
            var hours = add_zero(d.getHours());
            var minutes = add_zero(d.getMinutes());
            var seconds = add_zero(d.getSeconds());
            var ndate = years + "年" + month + "月" + days + "日 " + hours + ":"
                + minutes + ":" + seconds + " " + week;
            var divT = document.getElementById("logInfo");
            divT.innerHTML = ndate;
        }
        function add_zero(temp) {
            if (temp < 10)
                return "0" + temp;
            else
                return temp;
        }
        setInterval("getCurDate()", 100);
    </script>
    <style>
        .col-l {
            width: 10px;
        }

        .col-r {
            flex-grow: 1;
        }

        .content {
            display: flex;
        }

        body {
            background: none;
        }

        .grid {
            display: grid;
            gap: 10px;
            height: 100%;
        }

        .grid-item {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
            color: black;
        }

        #detailContent {
            color: black;
        }

        .custom-left {
            width: 80px;
            background-color: white;
            padding: 10px;
            height: 100vh;
        }

        .custom-right {
            flex-grow: 1;
            min-width: 100px;
            background-color: white;
            padding: 10px;
            height: 100vh;
        }

        .styled-table td {
            color: black;
        }
    </style>
</head>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<body>
    <div class="header">
        <h1 class="header-title">
            <a href="{{ url_for('main_page') }}" style="color: white; text-decoration: none;">后台管理</a>
        </h1>
        <div id="logInfo" style="text-align: left;color: #fff;position: relative;left: 10px;">
            <script type="text/JavaScript" language="JavaScript">
                getCurDate();
            </script>
        </div>
    </div>
    <div class="wrapper">
        <div class="content">
            <div class="custom-left">
                <div>
                    <div class="title">详细内容</div>
                    <div class="bcontent">
                        <table class="styled-table" id="infoTable">
                            <tbody>
                                <tr onclick="selectTerminal(this, 5, '终端一')">
                                    <td style="background-color: #ffcccc;">终端一</td> <!-- 设置背景色 -->
                                </tr>
                                <tr onclick="selectTerminal(this, 5, '终端二')">
                                    <td style="background-color: #ccffcc;">终端二</td> <!-- 设置背景色 -->
                                </tr>
                                <tr onclick="selectTerminal(this, 5, '终端三')">
                                    <td style="background-color: #ccccff;">终端三</td> <!-- 设置背景色 -->
                                </tr>
                                <tr onclick="selectTerminal(this, 5, '终端四')">
                                    <td style="background-color: #afc78f;">终端四</td> <!-- 设置背景色 -->
                                </tr>
                                <tr onclick="selectTerminal(this, 5, '终端五')">
                                    <td style="background-color: #3a5e86;">终端五</td> <!-- 设置背景色 -->
                                </tr>
                                <tr onclick="selectTerminal(this, 5, '终端六')">
                                    <td style="background-color: #994a75;">终端六</td> <!-- 设置背景色 -->
                                </tr>
                                <!-- 可以继续添加更多行 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="custom-right">
                <div>
                    <div class="title title-long" style="padding-left:25px">详细信息</div>
                    <div id="detailContent" class="bcontent" style="height: 100%;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>

        async function loadDataForTerminal(terminalName) {
            try {
                const response = await fetch('http://localhost:3000/save-data');
                if (!response.ok) {
                    console.error(`加载数据失败: ${response.status}`);
                    return;
                }
                const data = await response.json();
                const terminalData = data[terminalName];
                if (terminalData) {
                    for (let key in terminalData) {
                        const input = document.getElementById(key);
                        if (input) {
                            input.value = terminalData[key];
                        }
                    }
                }
            } catch (error) {
                console.error('加载数据时发生错误:', error);
            }
        }

        let currentTerminal = null; // 记录当前选择的终端
        document.addEventListener('DOMContentLoaded', async function () {
            // 假设页面加载时就以"终端一"作为默认终端
            currentTerminal = "终端一";

            // 手动调用 updateRightPanel 来生成对应的输入框(假设有一个虚拟的row对象或者您可以直接模拟这个过程)
            // 如果row对象是从表格中点击产生的，那么需要伪造或选择DOM中的第一行：
            const row = document.querySelector('#infoTable tr:nth-child(1)');
            if (row) {
                updateRightPanel(row, 5);
            }

            // 输入框生成后再加载数据
            await loadDataForTerminal(currentTerminal);
        });

        function selectTerminal(row, columns, terminalName) {
            currentTerminal = terminalName;
            updateRightPanel(row, columns);
            // 当终端选择变化后，加载该终端的数据
            loadDataForTerminal(terminalName);
        }

        function updateRightPanel(row, columns) {
            var content = row.cells[0].innerText; // 获取选中行的内容
            var backgroundColor = row.cells[0].style.backgroundColor; // 获取选中行第一个单元格的背景色
            var gridHtml = '<div class="grid" style="grid-template-columns: repeat(' + columns + ', 1fr); grid-template-rows: repeat(4, 1fr);">';

            // 根据选中的内容生成不同的表格
            if (content === "终端一") {
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">设备类型: <input type="text" id="net1" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">频道: <input type="text" id="net2" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">带宽: <input type="text" id="net3" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">IP地址: <input type="text" id="net4" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">电量（可选）: <input type="text" id="net5" placeholder="" /></div>';
            } else if (content === "终端二") {
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">设备类型: <input type="text" id="net1" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">频道: <input type="text" id="net2" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">带宽: <input type="text" id="net3" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">IP地址: <input type="text" id="net4" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">电量（可选）: <input type="text" id="net5" placeholder="" /></div>';
            } else if (content === "终端三") {
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">设备类型: <input type="text" id="net1" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">频道: <input type="text" id="net2" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">带宽: <input type="text" id="net3" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">IP地址: <input type="text" id="net4" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">电量（可选）: <input type="text" id="net5" placeholder="" /></div>';
            } else if (content === "终端四") {
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">设备类型: <input type="text" id="net1" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">频道: <input type="text" id="net2" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">带宽: <input type="text" id="net3" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">IP地址: <input type="text" id="net4" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">电量（可选）: <input type="text" id="net5" placeholder="" /></div>';
            } else if (content === "终端五") {
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">设备类型: <input type="text" id="net1" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">频道: <input type="text" id="net2" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">带宽: <input type="text" id="net3" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">IP地址: <input type="text" id="net4" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">电量（可选）: <input type="text" id="net5" placeholder="" /></div>';
            } else if (content === "终端六") {
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">设备类型: <input type="text" id="net1" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">频道: <input type="text" id="net2" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">带宽: <input type="text" id="net3" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">IP地址: <input type="text" id="net4" placeholder="" /></div>';
                gridHtml += '<div class="grid-item" style="background-color: ' + backgroundColor + ';">电量（可选）: <input type="text" id="net5" placeholder="" /></div>';
            }

            gridHtml += '</div>';

            // 添加上传按钮在表格右下角
            gridHtml += '<div style="text-align: right; margin-top: 10px;">';
            gridHtml += '<button onclick="submitData()" style="background-color: #4c70af; color: white; padding: 20px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 23px;">提交</button>';
            gridHtml += '</div>';

            document.getElementById("detailContent").innerHTML = gridHtml; // 更新右侧框内容
        }

        async function submitData() {
            if (!currentTerminal) {
                alert('请先选择一个终端');
                return;
            }

            // 从页面中获取数据
            const inputs = document.querySelectorAll('#detailContent input');
            const values = {};
            inputs.forEach(input => {
                values[input.id] = input.value;
            });

            const data = {
                terminal: currentTerminal,
                values: values
            };

            try {
                const response = await fetch('http://localhost:3000/save-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                if (response.ok) {
                    alert('数据已成功保存');
                } else {
                    console.error(`保存数据失败: ${response.status}`);
                    alert('数据保存失败，请检查服务器！');
                }
            } catch (error) {
                console.error('保存数据时发生错误:', error);
                alert('保存数据时发生错误，请检查服务器！');
            }
        }
    </script>

</body>

</html>